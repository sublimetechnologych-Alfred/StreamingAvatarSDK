<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Alfred con HeyGen SDK</title>
</head>
<body>
  <h1>Parla con Alfred</h1>
  <video id="avatar" autoplay playsinline style="width: 600px; border: 1px solid #ccc;"></video>
  <br>
  <button id="startBtn">Avvia Alfred</button>

  <!-- Import SDK ufficiale HeyGen -->
  <script src="https://unpkg.com/@heygen/streaming-avatar"></script>

  <script>
    const startBtn = document.getElementById("startBtn");
    const videoEl = document.getElementById("avatar");

    startBtn.onclick = async () => {
      try {
        // 1. Inizializza il client HeyGen
        const client = new HeygenStreaming.AvatarClient({
          token: "ODE4MWQ2NTE4NGYzNDA2M2I3ZTc5ZTBjNGI3M2Y1MjYtMTc1NzQxNDg1OA=="
        });

        // 2. Connetti Alfred
        const session = await client.createSession({
          avatar_id: "1837f93f22f94b88b9992853ca5e84f8", // tuo avatar Alfred
          voice_id: "5c1ade5e514c4c6c900b0ded224970fd" // Theo - Friendly
        });

        console.log("Sessione avviata:", session);

        // 3. Attacca il flusso al video
        session.on("track", (event) => {
          if (event.streams && event.streams[0]) {
            videoEl.srcObject = event.streams[0];
          }
        });

        // 4. Testo da dire
        await session.speak({
          text: "Ciao, sono Alfred. Ora funziono con lâ€™SDK ufficiale HeyGen!"
        });

      } catch (err) {
        console.error("Errore avvio Alfred:", err);
        alert("Errore: " + err.message);
      }
    };
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Alfred con HeyGen SDK</title>
  <script src="https://unpkg.com/@heygen/streaming-avatar/dist/index.umd.js"></script>
</head>
<body>
  <h1>Alfred (voce rassicurante, ~67 anni)</h1>

  <!-- qui verrà mostrato Alfred -->
  <div id="avatar-container" style="width: 640px; height: 480px; border: 1px solid #000;"></div>
  
  <button id="startBtn">Avvia Alfred</button>

  <script>
    document.getElementById("startBtn").addEventListener("click", async () => {
      try {
        // Chiamo il backend per creare la sessione
        const response = await fetch("/api/session");
        const data = await response.json();

        if (!data || !data.client_secret) {
          alert("Errore: sessione non creata!");
          return;
        }

        // Inizializzo l’SDK con la chiave di sessione
        const avatar = new HeyGenStreamingAvatar.Avatar({
          container: document.getElementById("avatar-container"),
          clientSecret: data.client_secret,
        });

        // Avvio Alfred
        await avatar.connect();

        // Faccio parlare Alfred con un testo iniziale
        await avatar.speak({
          text: "Ciao! Sono Alfred, piacere di conoscerti.",
          voice: "5c1ade5e514c4c6c900b0ded224970fd", // Theo - Friendly
          avatarId: "1837f93f22f94b88b9992853ca5e84f8"  // il tuo avatar personalizzato Alfred
        });

      } catch (err) {
        console.error("Errore nell’avvio di Alfred:", err);
        alert("Errore nell’avvio di Alfred!");
      }
    });
  </script>
</body>
</html>

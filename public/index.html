<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Parla con Alfred</title>
</head>
<body>
  <h1>Parla con Alfred</h1>
  <div id="video" style="width:400px;height:300px;background:black"></div>
  <br>
  <button id="startBtn">Avvia Alfred</button>
  <br><br>
  <input id="userMessage" type="text" placeholder="Scrivi qualcosa..." style="width:300px;">
  <button id="sendBtn">Invia</button>

  <script>
    let sessionId = null;

    document.getElementById("startBtn").onclick = async () => {
      const res = await fetch("/api/session", { method: "POST" });
      const data = await res.json();

      if (data.session_id) {
        sessionId = data.session_id;
        console.log("Sessione creata:", sessionId);
        alert("Sessione avviata!");
      } else {
        alert("Errore avvio Alfred!");
      }
    };

    document.getElementById("sendBtn").onclick = async () => {
      if (!sessionId) {
        alert("Avvia prima Alfred!");
        return;
      }
      const msg = document.getElementById("userMessage").value;
      if (!msg) return;

      const res = await fetch("/api/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg, session_id: sessionId })
      });

      const data = await res.json();
      console.log("Risposta Alfred:", data);
      alert("Alfred dice: " + data.answer);
    };
  </script>
</body>
</html>
